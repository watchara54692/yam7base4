<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2569 Energy Star Decoder</title>
    <style>
        :root { --primary: #1a2a3a; --gold: #b8860b; --bg: #fdfdfd; }
        body { font-family: 'Sarabun', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.1); }
        .header { text-align: center; border-bottom: 3px solid var(--gold); margin-bottom: 20px; padding-bottom: 10px; }
        
        .control-panel { display: flex; flex-wrap: wrap; gap: 10px; background: #f1f3f5; padding: 15px; border-radius: 10px; margin-bottom: 20px; justify-content: center; }
        input, button { padding: 12px; border-radius: 8px; border: 1px solid #ddd; outline: none; }
        button { background: var(--primary); color: white; cursor: pointer; font-weight: bold; border: none; min-width: 120px; }
        button:hover { background: #2c3e50; }

        /* ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á 21 ‡∏†‡∏û */
        .chart-container { width: 100%; overflow-x: auto; margin-bottom: 25px; border-radius: 8px; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; table-layout: fixed; }
        td { border: 1px solid #ececec; padding: 10px 2px; text-align: center; height: 70px; }
        .house-name { font-size: 0.75rem; color: #888; display: block; margin-bottom: 5px; }
        .star-num { font-size: 1.4rem; font-weight: bold; color: var(--primary); }
        .b4-row { background: #fff9e6; }
        .b4-num { color: #d35400; font-weight: 900; font-size: 1.4rem; }

        .dashboard { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 900px) { .dashboard { grid-template-columns: 1fr 1.2fr; } }
        
        .info-card { background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 5px solid var(--gold); }
        .rank-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
        .rank-id { width: 32px; height: 32px; background: var(--gold); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 15px; }
        .bar-bg { flex-grow: 1; height: 14px; background: #e9ecef; border-radius: 7px; margin: 0 15px; overflow: hidden; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, #1e3c72, #2a5298); transition: width 1s ease-out; }
        .score-val { font-weight: bold; width: 60px; text-align: right; color: #444; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1 style="margin:0;">‚ú® Energy Star Decoder 2569</h1>
        <p style="margin:5px 0 0 0; color:#666;">‡∏£‡∏∞‡∏ö‡∏ö‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏î‡∏≤‡∏ß 21 ‡∏†‡∏û ‡∏≠‡∏¥‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡∏Ñ‡∏ï‡∏¥‡∏õ‡∏µ‡∏°‡∏∞‡πÄ‡∏°‡∏µ‡∏¢</p>
    </div>

    <div class="control-panel">
        <div>
            <label style="display:block; font-size:0.75rem; font-weight:bold;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
            <input type="date" id="targetDate">
        </div>
        <div>
            <label style="display:block; font-size:0.75rem; font-weight:bold;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 06:00)</label>
            <input type="time" id="targetTime" value="16:00">
        </div>
        <button onclick="decodeEnergy()">‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô</button>
    </div>

    <div class="chart-container" id="chartArea"></div>

    <div class="dashboard">
        <div>
            <div id="astralSummary" class="info-card"></div>
            <p style="font-size:0.8rem; color:#888; margin-top:10px;">
                *‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏•‡∏Ç 7 ‡∏ï‡∏±‡∏ß ‡∏ê‡∏≤‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏Ç‡∏∂‡πâ‡∏ô 1 ‡∏Ñ‡πà‡∏≥ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏ó‡∏¢ <br>
                *‡∏ê‡∏≤‡∏ô‡∏õ‡∏µ 2569 ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô '‡∏°‡∏∞‡πÄ‡∏°‡∏µ‡∏¢ (7)' ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 19 ‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏° 2569
            </p>
        </div>
        <div class="rank-box">
            <h3 style="margin:0 0 15px 0;">üî• ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏î‡∏≤‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (0-9)</h3>
            <div id="rankingList"></div>
        </div>
    </div>
</div>

<script>
    const houses = [
        ["‡∏≠‡∏±‡∏ï‡∏ï‡∏≤", "‡∏´‡∏¥‡∏ô‡∏∞", "‡∏ò‡∏ô‡∏±‡∏á", "‡∏õ‡∏¥‡∏ï‡∏≤", "‡∏°‡∏≤‡∏ï‡∏≤", "‡πÇ‡∏†‡∏Ñ‡∏≤", "‡∏°‡∏±‡∏ä‡∏å‡∏¥‡∏°‡∏≤"],
        ["‡∏ï‡∏ô‡∏∏", "‡∏Å‡∏î‡∏∏‡∏°‡∏û‡∏∞", "‡∏™‡∏´‡∏±‡∏ä‡∏ä‡∏∞", "‡∏û‡∏±‡∏ô‡∏ò‡∏∏", "‡∏õ‡∏∏‡∏ï‡∏ï‡∏∞", "‡∏≠‡∏£‡∏¥", "‡∏õ‡∏±‡∏ï‡∏ô‡∏¥"],
        ["‡∏°‡∏£‡∏ì‡∏∞", "‡∏™‡∏∏‡∏†‡∏∞", "‡∏Å‡∏±‡∏°‡∏°‡∏∞", "‡∏•‡∏≤‡∏†‡∏∞", "‡∏û‡∏¢‡∏≤‡∏¢‡∏∞", "‡∏ó‡∏≤‡∏™‡∏≤", "‡∏ó‡∏≤‡∏™‡∏µ"]
    ];

    // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡∏Ñ‡∏ï‡∏¥‡πÑ‡∏ó‡∏¢‡∏õ‡∏µ 2569 (‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏ó‡∏¢ ‡∏Ç‡∏∂‡πâ‡∏ô 1 ‡∏Ñ‡πà‡∏≥)
    const lunar2569 = [
        { date: '2026-01-01', monthBase: 2, yearBase: 6 }, // ‡∏°.‡∏Ñ. ‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 2 ‡∏õ‡∏µ‡∏°‡∏∞‡πÄ‡∏™‡πá‡∏á
        { date: '2026-01-19', monthBase: 3, yearBase: 6 }, // ‡∏Ç‡∏∂‡πâ‡∏ô 1 ‡∏Ñ‡πà‡∏≥ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 3
        { date: '2026-02-18', monthBase: 4, yearBase: 6 }, // ‡∏Ç‡∏∂‡πâ‡∏ô 1 ‡∏Ñ‡πà‡∏≥ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 4
        { date: '2026-03-19', monthBase: 1, yearBase: 7 }, // ‡∏Ç‡∏∂‡πâ‡∏ô 1 ‡∏Ñ‡πà‡∏≥ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 5 (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏µ‡∏°‡∏∞‡πÄ‡∏°‡∏µ‡∏¢)
        { date: '2026-04-17', monthBase: 2, yearBase: 7 },
        { date: '2026-05-17', monthBase: 3, yearBase: 7 },
        { date: '2026-06-15', monthBase: 4, yearBase: 7 },
        { date: '2026-07-15', monthBase: 5, yearBase: 7 },
        { date: '2026-08-13', monthBase: 6, yearBase: 7 },
        { date: '2026-09-12', monthBase: 7, yearBase: 7 },
        { date: '2026-10-11', monthBase: 1, yearBase: 7 }, // ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 12
        { date: '2026-11-10', monthBase: 2, yearBase: 7 }, // ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 1
        { date: '2026-12-09', monthBase: 3, yearBase: 7 }  // ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 2
    ];

    function getLunarData(dateStr) {
        let found = lunar2569[0];
        for (let entry of lunar2569) {
            if (dateStr >= entry.date) found = entry;
            else break;
        }
        return found;
    }

    function decodeEnergy() {
        const dateInput = document.getElementById('targetDate').value;
        const timeInput = document.getElementById('targetTime').value;
        if (!dateInput) return;

        const timeParts = timeInput.split(':');
        const hour = parseInt(timeParts[0]);
        let dObj = new Date(dateInput);
        
        // ‡∏Å‡∏é 06:00 ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏±‡∏ô
        let dayBase = dObj.getDay() + 1; 
        if (hour < 6) {
            dayBase = dayBase - 1 === 0 ? 7 : dayBase - 1;
        }

        const lunar = getLunarData(dateInput);
        const mBase = lunar.monthBase;
        const yBase = lunar.yearBase;

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡∏ß‡∏á
        let chart = [[], [], []];
        for(let i=0; i<7; i++) {
            chart[0].push((dayBase + i - 1) % 7 + 1);
            chart[1].push((mBase + i - 1) % 7 + 1);
            chart[2].push((yBase + i - 1) % 7 + 1);
        }
        let b4 = chart[0].map((v, i) => v + chart[1][i] + chart[2][i]);

        renderUI(chart, b4);
        calculateRanking(chart, b4, dayBase, hour);
    }

    function renderUI(chart, b4) {
        let html = '<table>';
        for(let r=0; r<3; r++) {
            html += '<tr>';
            for(let c=0; c<7; c++) {
                html += `<td><span class="house-name">${houses[r][c]}</span><span class="star-num">${chart[r][c]}</span></td>`;
            }
            html += '</tr>';
        }
        html += '<tr class="b4-row">';
        b4.forEach(v => html += `<td><span class="house-name">‡∏ê‡∏≤‡∏ô‡∏£‡∏ß‡∏°</span><span class="b4-num">${v}</span></td>`);
        html += '</tr></table>';
        document.getElementById('chartArea').innerHTML = html;
    }

    function calculateRanking(chart, b4, day, hour) {
        let scores = { 1:0, 2:0, 3:0, 4:0, 5:0, 6:0, 7:0, 8:0, 9:0, 0:0 };
        
        // 1. ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏†‡∏û‡∏î‡∏µ/‡πÄ‡∏™‡∏µ‡∏¢
        for(let i=0; i<7; i++) {
            for(let r=0; r<3; r++) {
                let s = chart[r][i];
                let h = houses[r][i];
                if(["‡∏•‡∏≤‡∏†‡∏∞", "‡∏®‡∏∏‡∏†‡∏∞", "‡∏ò‡∏ô‡∏±‡∏á", "‡πÇ‡∏†‡∏Ñ‡∏≤", "‡∏°‡∏ô‡∏ï‡∏£‡∏µ"].includes(h)) scores[s] += 12;
                if(["‡∏≠‡∏£‡∏¥", "‡∏°‡∏£‡∏ì‡∏∞", "‡∏û‡∏¢‡∏≤‡∏¢‡∏∞", "‡∏´‡∏¥‡∏ô‡∏∞"].includes(h)) scores[s] -= 10;
            }
            // 2. ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ê‡∏≤‡∏ô 4 (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏Å)
            let val = b4[i];
            let topStar = chart[0][i];
            if([16, 14, 13, 19, 21].includes(val)) scores[topStar] += 25;
            if(val === 12) scores[8] += 22;
            if(val === 9)  scores[9] += 20;
            if(val === 10 || val === 20) scores[0] += 20;
        }

        // 3. ‡∏ó‡∏±‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏°‡∏≠‡∏±‡∏ê‡∏Å‡∏≤‡∏• (16.00 ‡∏ô.)
        const thaksaOrder = [1, 2, 3, 4, 7, 5, 8, 6];
        const sri = thaksaOrder[(thaksaOrder.indexOf(day) + 3) % 8];
        const kan = thaksaOrder[(thaksaOrder.indexOf(day) + 7) % 8];
        
        let yarnStar = 0;
        if(hour >= 6 && hour <= 18) {
            const yarnOrder = [1, 6, 4, 2, 7, 5, 3];
            let idx = Math.floor((hour - 6) / 1.5);
            yarnStar = yarnOrder[([0,1,2,3,4,5,6][day-1] + idx) % 7];
        }

        scores[sri] += 15;
        scores[kan] -= 25;
        if(yarnStar) scores[yarnStar] += 15;

        // ‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö
        let sorted = Object.entries(scores).sort((a,b) => b[1] - a[1]).slice(0, 5);
        let maxS = Math.max(...Object.values(scores), 1);
        
        let rankHtml = '';
        sorted.forEach((item, idx) => {
            let width = Math.max((item[1]/maxS)*100, 5);
            rankHtml += `
                <div class="rank-item">
                    <div class="rank-id">${idx+1}</div>
                    <div style="font-weight:bold; width:50px;">‡∏î‡∏≤‡∏ß ${item[0]}</div>
                    <div class="bar-bg"><div class="bar-fill" style="width:${width}%"></div></div>
                    <div class="score-val">${item[1].toFixed(0)}</div>
                </div>`;
        });
        document.getElementById('rankingList').innerHTML = rankHtml;
        document.getElementById('astralSummary').innerHTML = `
            <strong>‡∏ö‡∏ó‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏•‡πÇ‡∏¢‡∏Ñ:</strong><br>
            ‚Ä¢ ‡∏î‡∏≤‡∏ß‡∏®‡∏£‡∏µ (‡∏ô‡∏≥‡πÇ‡∏ä‡∏Ñ): <span style="color:green; font-weight:bold;">${sri}</span><br>
            ‚Ä¢ ‡∏î‡∏≤‡∏ß‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ: <span style="color:red; font-weight:bold;">${kan}</span><br>
            ‚Ä¢ ‡∏î‡∏≤‡∏ß‡πÄ‡∏à‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏¢‡∏≤‡∏°: <span style="color:blue; font-weight:bold;">${yarnStar || '‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤'}</span>
        `;
    }

    // Default Today
    document.getElementById('targetDate').valueAsDate = new Date();
    decodeEnergy();
</script>

</body>
</html>
