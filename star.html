<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Star Decoder - 7 ‡∏ï‡∏±‡∏ß 4 ‡∏ê‡∏≤‡∏ô</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
            --gold: #f1c40f;
            --bg: #f4f7f6;
            --cell-border: #dee2e6;
        }
        body { font-family: 'Sarabun', sans-serif; background: var(--bg); color: var(--primary); margin: 0; padding: 10px; }
        .container { max-width: 100%; margin: auto; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h1 { text-align: center; font-size: 1.5rem; margin-bottom: 15px; }
        
        .control-panel { display: flex; gap: 8px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
        input, select, button { padding: 8px; border-radius: 6px; border: 1px solid #ccc; font-size: 0.9rem; }
        button { background: var(--primary); color: white; border: none; cursor: pointer; padding: 8px 16px; }

        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ */
        .table-responsive { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        table { width: 100%; border-collapse: collapse; min-width: 340px; table-layout: fixed; }
        td { border: 1px solid var(--cell-border); padding: 4px 2px; text-align: center; vertical-align: middle; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏û‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏î‡∏≤‡∏ß */
        .house-label { font-size: 0.65rem; color: #7f8c8d; display: block; margin-bottom: 2px; white-space: nowrap; overflow: hidden; }
        .star-num { font-size: 1.1rem; font-weight: bold; color: var(--primary); }
        .base4-row { background-color: #fff9db; }
        .base4-label { font-size: 0.6rem; font-weight: bold; color: #96701c; }
        .base4-num { font-size: 1.1rem; font-weight: 800; color: #d35400; }

        .dashboard { display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 20px; }
        @media (min-width: 992px) { .dashboard { grid-template-columns: 1.2fr 0.8fr; } }

        .info-box { background: #f8f9fa; border-left: 4px solid var(--gold); padding: 10px; margin-bottom: 10px; font-size: 0.85rem; border-radius: 0 6px 6px 0; }
        
        /* Ranking Style */
        .rank-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
        .rank-circle { width: 28px; height: 28px; background: var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem; margin-right: 10px; flex-shrink: 0; }
        .energy-track { flex-grow: 1; height: 8px; background: #eee; border-radius: 4px; margin: 0 10px; overflow: hidden; }
        .energy-fill { height: 100%; background: linear-gradient(90deg, #3498db, #2ecc71); border-radius: 4px; transition: width 0.6s ease; }
        .score-text { font-size: 0.8rem; font-weight: bold; width: 55px; text-align: right; }
    </style>
</head>
<body>

<div class="container">
    <h1>‚ú® Energy Star Decoder</h1>
    
    <div class="control-panel">
        <input type="date" id="inputDate">
        <input type="time" id="inputTime" value="16:00">
        <button onclick="calculateAll()">‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô</button>
    </div>

    <div class="table-responsive" id="chartOutput"></div>

    <div class="dashboard">
        <div class="details-section">
            <div id="thaksaOutput" class="info-box"></div>
            <div id="yarnOutput" class="info-box"></div>
        </div>

        <div class="rank-section">
            <h3 style="font-size: 1.1rem; margin-top: 0;">üî• Top 5 ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏î‡∏≤‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</h3>
            <div id="rankOutput"></div>
        </div>
    </div>
</div>

<script>
    // 21 ‡∏†‡∏û ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç 7 ‡∏ï‡∏±‡∏ß
    const houseNames = [
        ["‡∏≠‡∏±‡∏ï‡∏ï‡∏≤", "‡∏´‡∏¥‡∏ô‡∏∞", "‡∏ò‡∏ô‡∏±‡∏á", "‡∏õ‡∏¥‡∏ï‡∏≤", "‡∏°‡∏≤‡∏ï‡∏≤", "‡πÇ‡∏†‡∏Ñ‡∏≤", "‡∏°‡∏±‡∏ä‡∏å‡∏¥‡∏°‡∏≤"],
        ["‡∏ï‡∏ô‡∏∏", "‡∏Å‡∏î‡∏∏‡∏°‡∏û‡∏∞", "‡∏™‡∏´‡∏±‡∏ä‡∏ä‡∏∞", "‡∏û‡∏±‡∏ô‡∏ò‡∏∏", "‡∏õ‡∏∏‡∏ï‡∏ï‡∏∞", "‡∏≠‡∏£‡∏¥", "‡∏õ‡∏±‡∏ï‡∏ô‡∏¥"],
        ["‡∏°‡∏£‡∏ì‡∏∞", "‡∏™‡∏∏‡∏†‡∏∞", "‡∏Å‡∏±‡∏°‡∏°‡∏∞", "‡∏•‡∏≤‡∏†‡∏∞", "‡∏û‡∏¢‡∏≤‡∏¢‡∏∞", "‡∏ó‡∏≤‡∏™‡∏≤", "‡∏ó‡∏≤‡∏™‡∏µ"]
    ];

    function calculateAll() {
        const dateInput = document.getElementById('inputDate').value;
        const timeInput = document.getElementById('inputTime').value;
        if (!dateInput) return;

        const date = new Date(dateInput);
        const dayOfWeek = date.getDay() === 0 ? 7 : date.getDay(); 
        const month = (date.getMonth() + 1); // ‡πÅ‡∏ö‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
        const year = (date.getFullYear() + 543) % 7 || 7;

        // 1. ‡∏ï‡∏±‡πâ‡∏á‡∏î‡∏ß‡∏á 3 ‡πÅ‡∏ñ‡∏ß
        let chart = [[], [], []];
        for (let i = 0; i < 7; i++) {
            chart[0].push((dayOfWeek + i - 1) % 7 + 1);
            chart[1].push((month + i - 1) % 7 + 1);
            chart[2].push((year + i - 1) % 7 + 1);
        }

        // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ê‡∏≤‡∏ô 4
        let base4 = [];
        for (let i = 0; i < 7; i++) {
            base4.push(chart[0][i] + chart[1][i] + chart[2][i]);
        }

        // 3. ‡∏ó‡∏±‡∏Å‡∏©‡∏≤ (‡∏≠‡∏¥‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)
        const thaksaNames = ["‡∏ö‡∏£‡∏¥‡∏ß‡∏≤‡∏£", "‡∏≠‡∏≤‡∏¢‡∏∏", "‡πÄ‡∏î‡∏ä", "‡∏®‡∏£‡∏µ", "‡∏°‡∏π‡∏•‡∏∞", "‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏∞", "‡∏°‡∏ô‡∏ï‡∏£‡∏µ", "‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ"];
        const thaksaMap = [1, 2, 3, 4, 7, 5, 8, 6]; 
        let dailyThaksa = {};
        let startIdx = thaksaMap.indexOf(dayOfWeek);
        for(let i=0; i<8; i++) {
            dailyThaksa[thaksaMap[(startIdx + i) % 8]] = thaksaNames[i];
        }

        // 4. ‡∏¢‡∏≤‡∏°‡∏≠‡∏±‡∏ê‡∏Å‡∏≤‡∏•
        const hour = parseInt(timeInput.split(':')[0]);
        const mins = parseInt(timeInput.split(':')[1]);
        const totalMins = (hour * 60) + mins;
        const yarnOrder = [1, 6, 4, 2, 7, 5, 3]; 
        let currentYarn = 0;
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ä‡πà‡∏ß‡∏á‡∏¢‡∏≤‡∏° (06:00 - 18:00 ‡πÅ‡∏ö‡πà‡∏á 8 ‡∏ä‡πà‡∏ß‡∏á‡πÜ ‡∏•‡∏∞ 90 ‡∏ô‡∏≤‡∏ó‡∏µ)
        if (totalMins >= 360 && totalMins <= 1080) {
            let yarnIdx = Math.floor((totalMins - 360) / 90);
            let dayStartIdx = [0, 1, 2, 3, 4, 5, 6][dayOfWeek-1];
            currentYarn = yarnOrder[(dayStartIdx + yarnIdx) % 7];
        }

        renderChart(chart, base4);
        calculateEnergyRanking(chart, base4, dailyThaksa, currentYarn);
        
        const sriStar = Object.keys(dailyThaksa).find(k => dailyThaksa[k] === '‡∏®‡∏£‡∏µ');
        document.getElementById('thaksaOutput').innerHTML = `<b>‡∏ó‡∏±‡∏Å‡∏©‡∏≤:</b> ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏î‡∏≤‡∏ß ${dayOfWeek} ‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏£‡∏¥‡∏ß‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏î‡∏≤‡∏ß ${sriStar} ‡πÄ‡∏õ‡πá‡∏ô <b>"‡∏®‡∏£‡∏µ"</b>`;
        document.getElementById('yarnOutput').innerHTML = `<b>‡∏¢‡∏≤‡∏° ${timeInput} ‡∏ô.:</b> ‡∏î‡∏≤‡∏ß ${currentYarn || '-'} ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤`;
    }

    function renderChart(chart, base4) {
        let html = '<table>';
        // ‡πÅ‡∏™‡∏î‡∏á 3 ‡πÅ‡∏ñ‡∏ß‡∏´‡∏•‡∏±‡∏Å‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏†‡∏û‡πÉ‡∏ô‡∏ï‡∏±‡∏ß
        for (let r = 0; r < 3; r++) {
            html += '<tr>';
            for (let c = 0; c < 7; c++) {
                html += `<td>
                            <span class="house-label">${houseNames[r][c]}</span>
                            <span class="star-num">${chart[r][c]}</span>
                         </td>`;
            }
            html += '</tr>';
        }
        // ‡πÅ‡∏ñ‡∏ß‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà 4
        html += '<tr class="base4-row">';
        base4.forEach(v => {
            html += `<td>
                        <span class="base4-label">‡∏ê‡∏≤‡∏ô 4</span>
                        <span class="base4-num">${v}</span>
                     </td>`;
        });
        html += '</tr></table>';
        document.getElementById('chartOutput').innerHTML = html;
    }

    function calculateEnergyRanking(chart, base4, thaksa, yarn) {
        let scores = { 1:0, 2:0, 3:0, 4:0, 5:0, 6:0, 7:0 };

        for (let i = 0; i < 7; i++) {
            for (let r = 0; r < 3; r++) {
                let star = chart[r][i];
                let house = houseNames[r][i];
                if (["‡∏•‡∏≤‡∏†‡∏∞", "‡∏®‡∏∏‡∏†‡∏∞", "‡∏ò‡∏ô‡∏±‡∏á", "‡∏°‡∏ô‡∏ï‡∏£‡∏µ", "‡πÇ‡∏†‡∏Ñ‡∏≤", "‡∏õ‡∏±‡∏ï‡∏ô‡∏¥"].includes(house)) scores[star] += 6;
                if (["‡∏≠‡∏£‡∏¥", "‡∏°‡∏£‡∏ì‡∏∞", "‡∏û‡∏¢‡∏≤‡∏¢‡∏∞", "‡∏´‡∏¥‡∏ô‡∏∞"].includes(house)) scores[star] -= 7;

                let b4 = base4[i];
                if ([16, 14, 13, 19, 21].includes(b4)) scores[star] += 15;
                if ([10, 20, 9].includes(b4)) scores[star] += 8;
                if ([7, 11, 12].includes(b4)) scores[star] -= 6;
            }
        }

        for (let star in scores) {
            if (thaksa[star] === "‡∏®‡∏£‡∏µ") scores[star] += 12;
            if (thaksa[star] === "‡∏°‡∏ô‡∏ï‡∏£‡∏µ") scores[star] += 7;
            if (thaksa[star] === "‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ") scores[star] -= 15;
            if (parseInt(star) === yarn) scores[star] += 10; 
        }

        let sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]).slice(0, 5);
        let maxScore = Math.max(...Object.values(scores), 1);

        let rankHtml = '';
        sorted.forEach((item, idx) => {
            let width = Math.max((item[1] / maxScore) * 100, 5);
            rankHtml += `
                <div class="rank-item">
                    <div class="rank-circle">${idx + 1}</div>
                    <div style="font-weight:bold; width:50px; font-size:0.9rem;">‡∏î‡∏≤‡∏ß ${item[0]}</div>
                    <div class="energy-track"><div class="energy-fill" style="width: ${width}%"></div></div>
                    <div class="score-text">${item[1].toFixed(1)}</div>
                </div>`;
        });
        document.getElementById('rankOutput').innerHTML = rankHtml;
    }

    document.getElementById('inputDate').valueAsDate = new Date();
    calculateAll();
</script>

</body>
        </html>
