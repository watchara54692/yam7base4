<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Star Decoder Pro - 0-9 Ranking</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e74c3c;
            --gold: #f1c40f;
            --bg: #f4f7f6;
            --cell-border: #dee2e6;
        }
        body { font-family: 'Sarabun', sans-serif; background: var(--bg); color: var(--primary); margin: 0; padding: 10px; }
        .container { max-width: 100%; margin: auto; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h1 { text-align: center; font-size: 1.4rem; margin-bottom: 15px; }
        
        .control-panel { display: flex; gap: 8px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
        input, button { padding: 8px; border-radius: 6px; border: 1px solid #ccc; font-size: 0.9rem; }
        button { background: var(--primary); color: white; border: none; cursor: pointer; padding: 8px 16px; font-weight: bold; }

        .table-responsive { width: 100%; overflow-x: auto; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; min-width: 350px; table-layout: fixed; }
        td { border: 1px solid var(--cell-border); padding: 5px 2px; text-align: center; }
        
        .house-label { font-size: 0.65rem; color: #7f8c8d; display: block; margin-bottom: 2px; }
        .star-num { font-size: 1.1rem; font-weight: bold; color: var(--primary); }
        .base4-row { background-color: #fff9db; }
        .base4-label { font-size: 0.6rem; font-weight: bold; color: #96701c; }
        .base4-num { font-size: 1.1rem; font-weight: 800; color: #d35400; }

        .dashboard { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 992px) { .dashboard { grid-template-columns: 1fr 1fr; } }

        .info-box { background: #f8f9fa; border-left: 4px solid var(--gold); padding: 10px; margin-bottom: 10px; font-size: 0.85rem; }
        
        .rank-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .rank-circle { width: 26px; height: 26px; background: var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.8rem; margin-right: 10px; flex-shrink: 0; }
        .energy-track { flex-grow: 1; height: 10px; background: #eee; border-radius: 5px; margin: 0 10px; overflow: hidden; }
        .energy-fill { height: 100%; background: linear-gradient(90deg, #3498db, #2ecc71); transition: width 0.6s ease; }
        .score-text { font-size: 0.8rem; font-weight: bold; width: 60px; text-align: right; }
    </style>
</head>
<body>

<div class="container">
    <h1>‚ú® Energy Star Decoder Pro</h1>
    
    <div class="control-panel">
        <input type="date" id="inputDate">
        <input type="time" id="inputTime" value="16:00">
        <button onclick="calculateAll()">‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô</button>
    </div>

    <div class="table-responsive" id="chartOutput"></div>

    <div class="dashboard">
        <div>
            <div id="thaksaOutput" class="info-box"></div>
            <div id="yarnOutput" class="info-box"></div>
            <p style="font-size: 0.75rem; color: #666; padding: 0 10px;">*‡πÄ‡∏•‡∏Ç 8, 9, 0 ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≤‡∏ß‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà 4</p>
        </div>

        <div class="rank-section">
            <h3 style="font-size: 1.1rem; margin-top: 0; color: var(--primary);">üî• Top 5 ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (0-9)</h3>
            <div id="rankOutput"></div>
        </div>
    </div>
</div>

<script>
    const houseNames = [
        ["‡∏≠‡∏±‡∏ï‡∏ï‡∏≤", "‡∏´‡∏¥‡∏ô‡∏∞", "‡∏ò‡∏ô‡∏±‡∏á", "‡∏õ‡∏¥‡∏ï‡∏≤", "‡∏°‡∏≤‡∏ï‡∏≤", "‡πÇ‡∏†‡∏Ñ‡∏≤", "‡∏°‡∏±‡∏ä‡∏å‡∏¥‡∏°‡∏≤"],
        ["‡∏ï‡∏ô‡∏∏", "‡∏Å‡∏î‡∏∏‡∏°‡∏û‡∏∞", "‡∏™‡∏´‡∏±‡∏ä‡∏ä‡∏∞", "‡∏û‡∏±‡∏ô‡∏ò‡∏∏", "‡∏õ‡∏∏‡∏ï‡∏ï‡∏∞", "‡∏≠‡∏£‡∏¥", "‡∏õ‡∏±‡∏ï‡∏ô‡∏¥"],
        ["‡∏°‡∏£‡∏ì‡∏∞", "‡∏™‡∏∏‡∏†‡∏∞", "‡∏Å‡∏±‡∏°‡∏°‡∏∞", "‡∏•‡∏≤‡∏†‡∏∞", "‡∏û‡∏¢‡∏≤‡∏¢‡∏∞", "‡∏ó‡∏≤‡∏™‡∏≤", "‡∏ó‡∏≤‡∏™‡∏µ"]
    ];

    function calculateAll() {
        const dateInput = document.getElementById('inputDate').value;
        const timeInput = document.getElementById('inputTime').value;
        if (!dateInput) return;

        const date = new Date(dateInput);
        const dayOfWeek = date.getDay() === 0 ? 7 : date.getDay(); 
        const month = (date.getMonth() + 1); 
        const year = (date.getFullYear() + 543) % 7 || 7;

        let chart = [[], [], []];
        for (let i = 0; i < 7; i++) {
            chart[0].push((dayOfWeek + i - 1) % 7 + 1);
            chart[1].push((month + i - 1) % 7 + 1);
            chart[2].push((year + i - 1) % 7 + 1);
        }

        let base4 = [];
        for (let i = 0; i < 7; i++) {
            base4.push(chart[0][i] + chart[1][i] + chart[2][i]);
        }

        const thaksaNames = ["‡∏ö‡∏£‡∏¥‡∏ß‡∏≤‡∏£", "‡∏≠‡∏≤‡∏¢‡∏∏", "‡πÄ‡∏î‡∏ä", "‡∏®‡∏£‡∏µ", "‡∏°‡∏π‡∏•‡∏∞", "‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏∞", "‡∏°‡∏ô‡∏ï‡∏£‡∏µ", "‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ"];
        const thaksaMap = [1, 2, 3, 4, 7, 5, 8, 6]; 
        let dailyThaksa = {};
        let startIdx = thaksaMap.indexOf(dayOfWeek);
        for(let i=0; i<8; i++) {
            dailyThaksa[thaksaMap[(startIdx + i) % 8]] = thaksaNames[i];
        }

        const hour = parseInt(timeInput.split(':')[0]);
        const mins = parseInt(timeInput.split(':')[1]);
        const totalMins = (hour * 60) + mins;
        const yarnOrder = [1, 6, 4, 2, 7, 5, 3]; 
        let currentYarn = 0;
        if (totalMins >= 360 && totalMins <= 1080) {
            let yarnIdx = Math.floor((totalMins - 360) / 90);
            let dayStartIdx = [0, 1, 2, 3, 4, 5, 6][dayOfWeek-1];
            currentYarn = yarnOrder[(dayStartIdx + yarnIdx) % 7];
        }

        renderChart(chart, base4);
        calculateEnergyRanking(chart, base4, dailyThaksa, currentYarn);
        
        const sriStar = Object.keys(dailyThaksa).find(k => dailyThaksa[k] === '‡∏®‡∏£‡∏µ');
        document.getElementById('thaksaOutput').innerHTML = `<b>‡∏ó‡∏±‡∏Å‡∏©‡∏≤:</b> ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏î‡∏≤‡∏ß ${dayOfWeek} ‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏£‡∏¥‡∏ß‡∏≤‡∏£ (‡∏î‡∏≤‡∏ß ${sriStar} ‡πÄ‡∏õ‡πá‡∏ô <b>‡∏®‡∏£‡∏µ</b>)`;
        document.getElementById('yarnOutput').innerHTML = `<b>‡∏¢‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤ ${timeInput} ‡∏ô.:</b> ‡∏î‡∏≤‡∏ß ${currentYarn || '-'} ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Å‡∏≤‡∏£`;
    }

    function renderChart(chart, base4) {
        let html = '<table>';
        for (let r = 0; r < 3; r++) {
            html += '<tr>';
            for (let c = 0; c < 7; c++) {
                html += `<td><span class="house-label">${houseNames[r][c]}</span><span class="star-num">${chart[r][c]}</span></td>`;
            }
            html += '</tr>';
        }
        html += '<tr class="base4-row">';
        base4.forEach(v => {
            html += `<td><span class="base4-label">‡∏ê‡∏≤‡∏ô 4</span><span class="base4-num">${v}</span></td>`;
        });
        html += '</tr></table>';
        document.getElementById('chartOutput').innerHTML = html;
    }

    function calculateEnergyRanking(chart, base4, thaksa, yarn) {
        // ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô 0-9
        let scores = { 1:0, 2:0, 3:0, 4:0, 5:0, 6:0, 7:0, 8:0, 9:0, 0:0 };

        for (let i = 0; i < 7; i++) {
            // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å 21 ‡∏†‡∏û (1-7)
            for (let r = 0; r < 3; r++) {
                let star = chart[r][i];
                let house = houseNames[r][i];
                if (["‡∏•‡∏≤‡∏†‡∏∞", "‡∏®‡∏∏‡∏†‡∏∞", "‡∏ò‡∏ô‡∏±‡∏á", "‡∏°‡∏ô‡∏ï‡∏£‡∏µ", "‡πÇ‡∏†‡∏Ñ‡∏≤"].includes(house)) scores[star] += 6;
                if (["‡∏≠‡∏£‡∏¥", "‡∏°‡∏£‡∏ì‡∏∞", "‡∏û‡∏¢‡∏≤‡∏¢‡∏∞", "‡∏´‡∏¥‡∏ô‡∏∞"].includes(house)) scores[star] -= 7;
            }

            // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô 4 (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏ñ‡∏∂‡∏á 8, 9, 0)
            let b4 = base4[i];
            
            // ‡∏ê‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏°‡∏á‡∏Ñ‡∏•/‡∏Å‡∏≥‡∏•‡∏±‡∏á (‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏î‡∏≤‡∏ß 1-7)
            if ([16, 14, 13, 19, 21].includes(b4)) {
                let targetStar = chart[0][i]; // ‡∏î‡∏≤‡∏ß‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏ß
                scores[targetStar] += 15;
            }

            // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡πÄ‡∏•‡∏Ç‡∏û‡∏¥‡πÄ‡∏®‡∏© 8, 9, 0 ‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏∞‡∏ö‡∏∏
            if (b4 === 12) scores[8] += 20; // 12 ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á 8
            if (b4 === 9)  scores[9] += 18; // 9 ‡∏Ñ‡∏∑‡∏≠‡∏û‡∏£‡∏∞‡πÄ‡∏Å‡∏ï‡∏∏
            if (b4 === 10 || b4 === 20) scores[0] += 18; // 10, 20 ‡∏Ñ‡∏∑‡∏≠‡∏°‡∏§‡∏ï‡∏¢‡∏π/‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏™‡∏≤‡∏£‡πå
        }

        // ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏°
        for (let star in scores) {
            let s = parseInt(star);
            if (thaksa[s] === "‡∏®‡∏£‡∏µ") scores[s] += 12;
            if (thaksa[s] === "‡∏Å‡∏≤‡∏•‡∏Å‡∏¥‡∏ì‡∏µ") scores[s] -= 15;
            if (s === yarn) scores[s] += 10; 
        }

        let sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]).slice(0, 5);
        let maxScore = Math.max(...Object.values(scores), 1);

        let rankHtml = '';
        sorted.forEach((item, idx) => {
            let width = Math.max((item[1] / maxScore) * 100, 5);
            rankHtml += `
                <div class="rank-item">
                    <div class="rank-circle">${idx + 1}</div>
                    <div style="font-weight:bold; width:50px;">‡∏î‡∏≤‡∏ß ${item[0]}</div>
                    <div class="energy-track"><div class="energy-fill" style="width: ${width}%"></div></div>
                    <div class="score-text">${item[1].toFixed(1)}</div>
                </div>`;
        });
        document.getElementById('rankOutput').innerHTML = rankHtml;
    }

    document.getElementById('inputDate').valueAsDate = new Date();
    calculateAll();
</script>

</body>
    </html>
